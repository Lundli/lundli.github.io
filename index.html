<head>
    <meta charset="UTF-8">
    <title>typehere.no</title>
    <style>
        :root {
            --line-number-width: 60px;
            --padding: 20px;
            --bg-color: #f0f0f0;
            --line-number-bg: #e8e8e8;
            --line-number-color: #888;
            --text-color: #333;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            overflow: hidden;
        }

        #editorContainer {
            display: flex;
            height: 100%;
            width: 100%;
        }

        #lineNumbers {
            width: var(--line-number-width);
            background-color: var(--line-number-bg);
            color: var(--line-number-color);
            font-family: "Lucida Console", "Courier New", monospace;
            font-size: 20px;
            text-align: right;
            padding: var(--padding) 10px var(--padding) 10px;
            overflow: hidden;
            user-select: none;
            line-height: 1.5;
            white-space: pre;
            transition: width 0.2s ease, opacity 0.2s ease, padding 0.2s ease;
        }

        #lineNumbers.hidden {
            width: 0;
            padding: 0;
            opacity: 0;
        }

        #typingCanvas {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            margin: 0;
            padding: var(--padding);
            resize: none;
            font-family: "Lucida Console", "Courier New", monospace;
            font-size: 20px;
            color: var(--text-color);
            line-height: 1.5;
            overflow-y: scroll;
            overflow-x: auto;
        }

        #typingCanvas:focus {
            outline: none;
        }
    </style>
</head>

<body>
    <div id="editorContainer">
        <div id="lineNumbers"></div>
        <textarea id="typingCanvas"></textarea>
    </div>

    <script>
        // State management
        const state = {
            lineNumbersVisible: localStorage.getItem('lineNumbersVisible') !== 'false',
            indentSize: 4
        };

        // Update line numbers based on textarea content
        function updateLineNumbers() {
            const textarea = document.getElementById('typingCanvas');
            const lineNumbersDiv = document.getElementById('lineNumbers');

            const lines = textarea.value.split('\n');
            const lineCount = lines.length;

            let lineNumbersHtml = '';
            for (let i = 1; i <= lineCount; i++) {
                lineNumbersHtml += i + '\n';
            }

            lineNumbersDiv.textContent = lineNumbersHtml;
        }

        // Synchronize scroll between line numbers and textarea
        function syncScroll() {
            const textarea = document.getElementById('typingCanvas');
            const lineNumbersDiv = document.getElementById('lineNumbers');
            lineNumbersDiv.scrollTop = textarea.scrollTop;
        }

        // Handle Tab and Shift+Tab for indentation
        function handleTabKey(e) {
            const textarea = e.target;
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const value = textarea.value;

            if (e.key === 'Tab') {
                e.preventDefault();

                if (e.shiftKey) {
                    // Shift+Tab: Remove indentation
                    const lineStart = value.lastIndexOf('\n', start - 1) + 1;
                    const lineText = value.substring(lineStart, start);

                    const leadingSpaces = lineText.match(/^ */)[0].length;
                    const spacesToRemove = Math.min(leadingSpaces, state.indentSize);

                    if (spacesToRemove > 0) {
                        const newValue =
                            value.substring(0, lineStart) +
                            value.substring(lineStart + spacesToRemove);

                        textarea.value = newValue;
                        textarea.selectionStart = start - spacesToRemove;
                        textarea.selectionEnd = end - spacesToRemove;

                        textarea.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                } else {
                    // Tab: Insert spaces
                    const spaces = ' '.repeat(state.indentSize);
                    const newValue =
                        value.substring(0, start) +
                        spaces +
                        value.substring(end);

                    textarea.value = newValue;
                    textarea.selectionStart = textarea.selectionEnd = start + state.indentSize;

                    textarea.dispatchEvent(new Event('input', { bubbles: true }));
                }
            }
        }

        // Toggle line numbers visibility
        function toggleLineNumbers() {
            const container = document.getElementById('editorContainer');
            const lineNumbersDiv = document.getElementById('lineNumbers');

            state.lineNumbersVisible = !state.lineNumbersVisible;

            if (state.lineNumbersVisible) {
                lineNumbersDiv.classList.remove('hidden');
                updateLineNumbers();
            } else {
                lineNumbersDiv.classList.add('hidden');
            }

            localStorage.setItem('lineNumbersVisible', state.lineNumbersVisible);
        }

        // Handle Ctrl+Shift+L / Cmd+Shift+L shortcut for toggling line numbers
        function handleToggleShortcut(e) {
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'L') {
                e.preventDefault();
                toggleLineNumbers();
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            const typingCanvas = document.getElementById('typingCanvas');
            const lineNumbersDiv = document.getElementById('lineNumbers');

            // Load saved text
            typingCanvas.value = localStorage.getItem('storedText') || '';

            // Initialize line numbers visibility
            if (!state.lineNumbersVisible) {
                lineNumbersDiv.classList.add('hidden');
            } else {
                updateLineNumbers();
            }

            // Event listeners
            typingCanvas.addEventListener('input', () => {
                localStorage.setItem('storedText', typingCanvas.value);
                updateLineNumbers();
            });

            typingCanvas.addEventListener('scroll', syncScroll);
            typingCanvas.addEventListener('keydown', handleTabKey);
            document.addEventListener('keydown', handleToggleShortcut);
            window.addEventListener('resize', updateLineNumbers);
        });
    </script>
</body>

</html>